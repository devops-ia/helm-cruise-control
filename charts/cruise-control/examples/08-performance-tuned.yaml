# Performance-Tuned Configuration Example
# This example demonstrates performance optimizations:
# - JVM tuning for performance
# - Optimized resource allocation
# - Fine-tuned Kafka settings
# - Performance monitoring configurations
# - Aggressive garbage collection settings
# - High-performance node selection

image:
  repository: ghcr.io/devops-ia/kafka-cruise-control
  tag: "latest"
  pullPolicy: IfNotPresent

replicaCount: 1

resources:
  limits:
    cpu: 4000m
    memory: 6Gi
  requests:
    cpu: 2000m
    memory: 4Gi

service:
  type: ClusterIP
  port: 80
  targetPort: 9090

livenessProbe:
  enabled: true
  initialDelaySeconds: 30
  periodSeconds: 10
  timeoutSeconds: 5
  failureThreshold: 3

readinessProbe:
  enabled: true
  initialDelaySeconds: 20
  periodSeconds: 10
  timeoutSeconds: 3
  failureThreshold: 3

nodeSelector:
  node-type: high-performance

tolerations:
  - key: "node-type"
    operator: "Equal"
    value: "high-performance"
    effect: "NoSchedule"

affinity:
  nodeAffinity:
    requiredDuringSchedulingIgnoredDuringExecution:
      nodeSelectorTerms:
        - matchExpressions:
            - key: node-type
              operator: In
              values:
                - high-performance

# JVM performance tuning via environment variables
env:
  JAVA_OPTS: >-
    -Xms4G
    -Xmx4G
    -XX:+UseG1GC
    -XX:MaxGCPauseMillis=20
    -XX:InitiatingHeapOccupancyPercent=35
    -XX:+ExplicitGCInvokesConcurrent
    -XX:MaxInlineLevel=15
    -XX:+UseCompressedOops
    -XX:+AlwaysPreTouch
    -XX:+DisableExplicitGC

# Configure default settings for all clusters
clustersDefaults:
  # Cluster configuration
  cluster:
    min.insync.replicas: 2

  # Capacity configuration
  capacity:
    type: capacity
    config: |
      {
        "brokerCapacities": [
          {
            "brokerId": "-1",
            "capacity": {
              "DISK": "5000000",
              "CPU": "100",
              "NW_IN": "200000",
              "NW_OUT": "200000"
            },
            "doc": "High-performance capacity configuration."
          }
        ]
      }

  # Performance-tuned Cruise Control configuration
  config:
    # METADATA CLIENT
    bootstrap.servers: "kafka-broker:9092"
    client.id: "cruise-control-perf"
    connections.max.idle.ms: 540000

    # LOAD MONITOR - Performance tuning
    broker.metric.sample.store.topic: "__KafkaCruiseControlModelTrainingSamples"
    broker.metrics.window.ms: 300000
    num.broker.metrics.windows: 5
    min.samples.per.broker.metrics.window: 3
    partition.metric.sample.store.topic: "__KafkaCruiseControlPartitionMetricSamples"
    partition.metrics.window.ms: 300000
    num.partition.metrics.windows: 5
    min.samples.per.partition.metrics.window: 3
    metric.sampler.class: com.linkedin.kafka.cruisecontrol.monitor.sampling.prometheus.PrometheusMetricSampler
    prometheus.server.endpoint: thanos-query.prometheus:9090
    metric.sampling.interval.ms: 120000
    sample.store.topic.replication.factor: 2
    num.sample.loading.threads: 8

    # ANALYZER - Performance goals
    cpu.balance.threshold: 1.05
    cpu.capacity.threshold: 0.8
    disk.balance.threshold: 1.05
    disk.capacity.threshold: 0.85
    network.inbound.balance.threshold: 1.05
    network.inbound.capacity.threshold: 0.8
    network.outbound.balance.threshold: 1.05
    network.outbound.capacity.threshold: 0.8

    default.goals:
    - com.linkedin.kafka.cruisecontrol.analyzer.goals.RackAwareGoal
    - com.linkedin.kafka.cruisecontrol.analyzer.goals.ReplicaCapacityGoal
    - com.linkedin.kafka.cruisecontrol.analyzer.goals.DiskCapacityGoal
    - com.linkedin.kafka.cruisecontrol.analyzer.goals.NetworkInboundCapacityGoal
    - com.linkedin.kafka.cruisecontrol.analyzer.goals.NetworkOutboundCapacityGoal
    - com.linkedin.kafka.cruisecontrol.analyzer.goals.CpuCapacityGoal

    hard.goals:
    - com.linkedin.kafka.cruisecontrol.analyzer.goals.RackAwareGoal

    # EXECUTOR - Performance optimization
    max.num.cluster.partition.movements: 1000
    num.concurrent.partition.movements.per.broker: 16
    num.concurrent.intra.broker.partition.movements: 4
    num.concurrent.leader.movements: 1000
    execution.progress.check.interval.ms: 10000

    replica.movement.strategies:
    - com.linkedin.kafka.cruisecontrol.executor.strategy.PrioritizeLargeReplicaMovementStrategy
    - com.linkedin.kafka.cruisecontrol.executor.strategy.BaseReplicaMovementStrategy

    # ANOMALY DETECTOR
    anomaly.detection.interval.ms: "10000"
    metric.anomaly.detection.interval.ms: 120000
    self.healing.enabled: false

    # WEBSERVER
    webserver.http.port: 9090
    webserver.http.address: 0.0.0.0
    webserver.accesslog.enabled: true
    webserver.request.maxBlockTimeMs: 10000

  # Log4j configuration
  log4j:
    rootLogger.level: INFO
    logger.cruisecontrol.level: info
    logger.detector.level: info

# Configure single performance-tuned cluster
clusters:
  high-perf-cluster: {}
